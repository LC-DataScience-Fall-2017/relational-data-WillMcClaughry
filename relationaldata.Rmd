---
title: "Relational Data"
author: "Will McClaughry"
date: "October 29, 2017"
output: html_document
---

#10.2.1 Excersises

1. Variables needed: origin and dest from the flights table and longitude and latitude from airports 

table.

You would merge the flights table with the airports table two times, first to get location of the origin

airport then to get the location of the dest airport.

2. "origin"" in weather should be matched with "faa"" in airports

3. Weather variables: year, month, day, hour, and origin, matched with year, month, day, hour, and dest 

from "flight".

4. Make a table for the special dates. Date would be primary key. The table would need to match to the 

year, month, and day columns of "flights".

#10.3.1 Excersises

1.
```{r}
flights %>% 
  arrange(year, month, day, sched_dep_time, carrier, flight) %>%
  mutate(flight_id = row_number()) %>%
  glimpse()
```

2.

  1.
```{r}
Lahman::Batting %>%
  group_by(playerID, yearID, stint) %>%
  filter(n() > 1) %>%
  nrow()
```
  
The primary key for Lahman::Batting is playerID, yearID, stint
  
  2. 
```{r}
babynames::babynames %>%
  group_by(year, sex, name) %>%
  filter(n() > 1) %>%
  nrow()
```
  
Primary key for babynames::babynames is year, sex, name

  3.
```{r}
nasaweather::atmos %>%
  group_by(lat, long, year, month) %>%
  filter(n() > 1) %>%
  nrow()
```
  Primary key is nasaweather::atmo
  
  4.
```{r}
fueleconomy::vehicles %>%
  group_by(id) %>%
  filter(n() > 1) %>%
  nrow()
```
  id is the the primary key for fueleconomy::vehicles
  
  5. 
```{r}
ggplot2::diamonds %>%
  distinct() %>% 
  nrow()
nrow(ggplot2::diamonds)
```
  no primary key
  
3.
```{r}
airports %>%
  semi_join(flights, c("faa" = "dest")) %>%
  ggplot(aes(lon, lat)) + borders("state") + geom_point() + coord_quickmap()
```

4. 
```{r}
flights %>%
  left_join(airports, by = c(dest = "faa")) %>%
  left_join(airports, by = c(origin = "faa")) %>%
  head()
```

5.
```{r}
plane_ages <- 
  planes %>%
  mutate(age = 2013 - year) %>%
  select(tailnum, age)

flights %>%
  inner_join(plane_ages, by = "tailnum") %>%
  group_by(age) %>%
  filter(!is.na(dep_delay)) %>%
  summarise(delay = mean(dep_delay)) %>%
  ggplot(aes(x = age, y = delay)) + geom_point() + geom_line()
```

No there is no relationship between plane age and delays
